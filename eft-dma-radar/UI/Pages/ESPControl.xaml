<UserControl x:Class="eft_dma_radar.UI.Pages.ESPControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:hc="https://handyorg.github.io/handycontrol"
             xmlns:controls="clr-namespace:eft_dma_shared.Common.UI.Controls;assembly=eft-dma-shared"
             mc:Ignorable="d"
             d:DesignHeight="1500" d:DesignWidth="350"
             MinWidth="200" MinHeight="200">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header - Draggable area -->
        <Border x:Name="DragHandle" Grid.Row="0" Style="{StaticResource PanelHeader}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="透视设置" Style="{StaticResource PanelHeaderText}"/>

                <!-- Close button -->
                <Border Grid.Column="1" Style="{StaticResource CloseButtonBorder}">
                    <Button x:Name="btnCloseHeader" Style="{StaticResource CloseButton}"/>
                </Border>
            </Grid>
        </Border>

        <Grid Grid.Row="1">
            <Border Background="{DynamicResource RegionBrush}" 
                    CornerRadius="0,0,8,8"/>

            <hc:TabControl Style="{StaticResource TabControlInLine}"
                          HorizontalContentAlignment="Left"
                          Background="Transparent"
                          BorderThickness="0">

                <!-- Chams Tab -->
                <hc:TabItem Header="着色">
                    <ScrollViewer Style="{StaticResource PanelScrollViewer}">
                        <hc:SimpleStackPanel>
                            <!-- General Settings Section -->
                            <Expander x:Name="expChamsGeneralSettings" Header="通用设置" Style="{StaticResource PanelExpander}" IsExpanded="True">
                                <hc:SimpleStackPanel Style="{StaticResource ExpanderContent}" Margin="2,8,2,0">
                                    <!-- Enable Chams -->
                                    <CheckBox x:Name="chkEnableChams" Content="启用着色" 
                                              Style="{StaticResource DynamicCheckBoxStyle}" 
                                              Margin="0,0,0,15" Tag="EnableChams"/>

                                    <!-- Chams Material Management -->
                                    <GroupBox Header="材质管理" Style="{StaticResource TransparentGroupBoxStyle}"
                                              Padding="5,0,5,5" Margin="0,0,0,8">
                                        <hc:SimpleStackPanel Margin="0,5,0,0">
                                            <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" Margin="0,0,0,0"
                                                           Text="材质状态:"
                                                           Style="{StaticResource LabelText}"
                                                           FontSize="14"
                                                           VerticalAlignment="Center"/>

                                                <TextBlock x:Name="txtChamsMaterialStatus" 
                                                           Grid.Column="1" Margin="4,0,0,0"
                                                           Text="未知" 
                                                           Style="{StaticResource LabelText}"
                                                           FontSize="14"
                                                           VerticalAlignment="Center"/>

                                                <TextBlock x:Name="txtChamsMaterialCount" 
                                                           Grid.Column="2" Margin="0,0,0,0"
                                                           Text="已加载 0/0" 
                                                           Style="{StaticResource LabelText}"
                                                           FontSize="14"
                                                           VerticalAlignment="Center"/>
                                            </Grid>

                                            <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="8"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <Button x:Name="btnRefreshChamsMaterials" 
                                                        Grid.Column="0"
                                                        Content="🔄 刷新材质" 
                                                        Style="{StaticResource ButtonWarning}"
                                                        HorizontalAlignment="Stretch"
                                                        ToolTip="强制刷新所有着色材质。如果材质加载失败，请使用此选项。"
                                                        Tag="RefreshChamsMaterials"/>

                                                <Button x:Name="btnClearChamsCache" 
                                                        Grid.Column="2"
                                                        Content="🗑️ 清除缓存" 
                                                        Style="{StaticResource ButtonDanger}"
                                                        HorizontalAlignment="Stretch"
                                                        ToolTip="清除着色材质缓存并在下次刷新时强制完全重新加载。"
                                                        Tag="ClearChamsCache"/>
                                            </Grid>

                                            <hc:SimpleStackPanel Margin="0,0,0,0">
                                                <!-- Warning Text -->
                                                <TextBlock x:Name="txtAdvancedMemWritesWarning"
                                                           TextWrapping="Wrap"
                                                           Style="{StaticResource LabelText}"
                                                           FontSize="13"
                                                           TextAlignment="Center"
                                                           VerticalAlignment="Center">
                                                           <Run Text="⚠" FontSize="16" />
                                                           <Run Text="高级材质类型"/>
                                                           <Run Text="(线框、可见性检查发光、可见性检查平面)" FontWeight="Bold"/>
                                                           <Run Text="需要"/>
                                                           <Run Text="高级内存写入" FontWeight="Bold" Foreground="Orange"/>
                                                </TextBlock>
                                            </hc:SimpleStackPanel>
                                        </hc:SimpleStackPanel>
                                    </GroupBox>
                                </hc:SimpleStackPanel>
                            </Expander>

                            <!-- Entity Settings Section -->
                            <Expander x:Name="expChamsEntitySettings" Header="实体设置" Style="{StaticResource PanelExpander}" IsExpanded="True">
                                <hc:SimpleStackPanel Style="{StaticResource ExpanderContent}" Margin="2,8,2,0">
                                    <!-- Entity Type Selection -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Text="实体类型" Style="{StaticResource LabelText}" 
                                                   VerticalAlignment="Center" Grid.Column="0"/>

                                        <hc:ComboBox x:Name="cboChamsEntityType" Grid.Column="1">
                                            <ComboBoxItem Content="AI" Tag="AI"/>
                                            <ComboBoxItem Content="自瞄目标" Tag="AimbotTarget"/>
                                            <ComboBoxItem Content="Boss" Tag="Boss"/>
                                            <ComboBoxItem Content="玩家Scav" Tag="PlayerScav"/>
                                            <ComboBoxItem Content="PMC" Tag="PMC"/>
                                            <ComboBoxItem Content="掠夺者/Rogue/守卫" Tag="Guard"/>
                                            <ComboBoxItem Content="队友" Tag="Teammate"/>
                                            <ComboBoxItem Content="容器" Tag="Container"/>
                                            <ComboBoxItem Content="重要物品" Tag="ImportantItem"/>
                                            <ComboBoxItem Content="任务物品" Tag="QuestItem"/>
                                        </hc:ComboBox>
                                    </Grid>

                                    <!-- Entity Enabled Checkbox -->
                                    <CheckBox x:Name="chkEntityEnabled" Content="实体着色" 
                                              Style="{StaticResource DynamicCheckBoxStyle}" 
                                              Margin="0,0,0,12" Tag="EntityEnabled"/>

                                    <!-- Material Type Selection -->
                                    <Grid x:Name="materialGroup" Margin="0,0,0,8" Visibility="Visible">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Text="材质类型" Style="{StaticResource LabelText}" 
                                                   VerticalAlignment="Center" Grid.Column="0"/>

                                        <hc:ComboBox x:Name="cboMaterialType" Grid.Column="1" Tag="MaterialType">
                                            <ComboBoxItem Content="基础" Tag="Basic" IsSelected="True"/>
                                            <ComboBoxItem Content="可见" Tag="Visible"/>
                                            <ComboBoxItem Content="线框" Tag="WireFrame"/>
                                            <ComboBoxItem Content="可见性检查发光" Tag="VisCheckGlow"/>
                                            <ComboBoxItem Content="可见性检查平面" Tag="VisCheckFlat"/>
                                        </hc:ComboBox>
                                    </Grid>

                                    <!-- Player Entity Material Types -->
                                    <GroupBox x:Name="playerEntityGroup" Header="材质类型" Style="{StaticResource TransparentGroupBoxStyle}"
                                              Padding="5,0,5,5" Margin="0,0,0,12" Visibility="Collapsed">
                                        <hc:SimpleStackPanel Margin="0,5,0,0">
                                            <!-- Clothing Chams -->
                                            <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="120"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <CheckBox x:Name="chkClothingChamsEnabled" Content="服装着色" 
                                                          Style="{StaticResource DynamicCheckBoxStyle}" 
                                                          Grid.Column="0" Tag="ClothingChamsEnabled"
                                                          VerticalAlignment="Center"/>

                                                <hc:ComboBox x:Name="cboClothingMaterialType" Grid.Column="1" Tag="ClothingMaterialType">
                                                    <ComboBoxItem Content="基础" Tag="Basic" IsSelected="True"/>
                                                    <ComboBoxItem Content="可见" Tag="Visible"/>
                                                    <ComboBoxItem Content="线框" Tag="WireFrame"/>
                                                    <ComboBoxItem Content="可见性检查发光" Tag="VisCheckGlow"/>
                                                    <ComboBoxItem Content="可见性检查平面" Tag="VisCheckFlat"/>
                                                </hc:ComboBox>
                                            </Grid>

                                            <!-- Gear Chams -->
                                            <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="120"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <CheckBox x:Name="chkGearChamsEnabled" Content="装备着色" 
                                                          Style="{StaticResource DynamicCheckBoxStyle}" 
                                                          Grid.Column="0" Tag="GearChamsEnabled"
                                                          VerticalAlignment="Center"/>

                                                <hc:ComboBox x:Name="cboGearMaterialType" Grid.Column="1" Tag="GearMaterialType">
                                                    <ComboBoxItem Content="基础" Tag="Basic" IsSelected="True"/>
                                                    <ComboBoxItem Content="可见" Tag="Visible"/>
                                                    <ComboBoxItem Content="线框" Tag="WireFrame"/>
                                                    <ComboBoxItem Content="可见性检查发光" Tag="VisCheckGlow"/>
                                                    <ComboBoxItem Content="可见性检查平面" Tag="VisCheckFlat"/>
                                                </hc:ComboBox>
                                            </Grid>

                                            <!-- Death Material -->
                                            <Grid Margin="0,0,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="120"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <CheckBox x:Name="chkDeathMaterialEnabled" Content="死亡材质" 
                                                          Style="{StaticResource DynamicCheckBoxStyle}" 
                                                          Grid.Column="0" Tag="DeathMaterialEnabled"
                                                          VerticalAlignment="Center"/>

                                                <hc:ComboBox x:Name="cboDeathMaterialType" Grid.Column="1" Tag="DeathMaterialType">
                                                    <ComboBoxItem Content="基础" Tag="Basic"/>
                                                    <ComboBoxItem Content="可见" Tag="Visible"/>
                                                    <ComboBoxItem Content="线框" Tag="WireFrame"/>
                                                    <ComboBoxItem Content="可见性检查发光" Tag="VisCheckGlow"/>
                                                    <ComboBoxItem Content="可见性检查平面" Tag="VisCheckFlat" IsSelected="True"/>
                                                </hc:ComboBox>
                                            </Grid>
                                        </hc:SimpleStackPanel>
                                    </GroupBox>

                                    <!-- Material Color Selection -->
                                    <GroupBox x:Name="materialColorGroup" Header="Material Color Selection" Style="{StaticResource TransparentGroupBoxStyle}"
                                              Padding="5,0,5,5" Margin="0,0,0,12">
                                        <hc:SimpleStackPanel Margin="0,5,0,0">
                                            <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="120"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Text="Material Type" Style="{StaticResource LabelText}" 
                                                           VerticalAlignment="Center" Grid.Column="0"/>

                                                <hc:ComboBox x:Name="cboColorMaterialType" Grid.Column="1" Tag="ColorMaterialType">
                                                    <ComboBoxItem Content="WireFrame" Tag="WireFrame" IsSelected="True"/>
                                                    <ComboBoxItem Content="VisCheck Glow" Tag="VisCheckGlow"/>
                                                    <ComboBoxItem Content="VisCheck Flat" Tag="VisCheckFlat"/>
                                                </hc:ComboBox>
                                            </Grid>

                                            <!-- Colors -->
                                            <Grid Margin="0,5,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="20"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>

                                                <TextBlock Text="Visible " Grid.Row="0" Grid.Column="0" 
                                                           Style="{StaticResource ColorPickerLabel}"/>
                                                <Button x:Name="btnChamsVisibleColor" Grid.Row="0" Grid.Column="1" Tag="VisibleColor"
                                                        Style="{StaticResource ColorPickerButtonPreserveColor}">
                                                    <Button.Background>
                                                        <SolidColorBrush x:Name="chamsVisibleColor" Color="Green"/>
                                                    </Button.Background>
                                                </Button>

                                                <TextBlock Text="Invisible Color" Grid.Row="0" Grid.Column="3" 
                                                           Style="{StaticResource ColorPickerLabel}"/>
                                                <Button x:Name="btnChamsInvisibleColor" Grid.Row="0" Grid.Column="4" Tag="InvisibleColor"
                                                        Style="{StaticResource ColorPickerButtonPreserveColor}">
                                                    <Button.Background>
                                                        <SolidColorBrush x:Name="chamsInvisibleColor" Color="Red"/>
                                                    </Button.Background>
                                                </Button>
                                            </Grid>
                                        </hc:SimpleStackPanel>
                                    </GroupBox>
                                </hc:SimpleStackPanel>
                            </Expander>
                        </hc:SimpleStackPanel>
                    </ScrollViewer>
                </hc:TabItem>

                <!-- Fuser Tab -->
                <hc:TabItem Header="热熔">
                    <ScrollViewer Style="{StaticResource PanelScrollViewer}">
                        <hc:SimpleStackPanel>
                            <!-- Fuser Settings Section -->
                            <Expander x:Name="expFuserGeneralSettings" Header="通用设置" Style="{StaticResource PanelExpander}" IsExpanded="True">
                                <hc:SimpleStackPanel Style="{StaticResource ExpanderContent}" Margin="2,8,2,0">
                                    <!-- Enable Fuser -->
                                    <Button x:Name="btnStartESP" Content="启动透视" Tag="StartESP"
                                            HorizontalAlignment="Left" Margin="0,0,0,8"
                                                Style="{StaticResource ButtonPrimary}"/>

                                    <!-- Auto Fullscreen Checkbox -->
                                    <CheckBox x:Name="chkAutoFullscreen" Content="自动全屏" Tag="AutoFullscreen"
                                              Style="{StaticResource DynamicCheckBoxStyle}" 
                                              Margin="0,0,0,8"/>

                                    <!-- FPS Cap Slider -->
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="帧率上限" Style="{StaticResource LabelText}" 
                                                   VerticalAlignment="Center" Grid.Column="0"/>
                                        <hc:NumericUpDown x:Name="nudFPSCap" Value="60" Minimum="30" Maximum="500"
                                                          Grid.Column="1" Width="80" HorizontalAlignment="Left" Tag="FPSCap"/>
                                    </Grid>

                                    <!-- Font Scale Slider -->
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="字体缩放" Style="{StaticResource LabelText}" 
                                                   VerticalAlignment="Center" Grid.Column="0"/>
                                        <controls:TextValueSlider
                                            x:Name="sldrFuserFontScale" Tag="FuserFontScale"
                                            Minimum="0.5" Maximum="5"
                                            SmallChange="0.1" 
                                            TickFrequency="0.1"
                                            IsSnapToTickEnabled="True"
                                            ContentStringFormat="{}{0:0.0x}" 
                                            Grid.Column="1"/>
                                    </Grid>

                                    <!-- Line Scale Slider -->
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="线条缩放" Style="{StaticResource LabelText}" 
                                                   VerticalAlignment="Center" Grid.Column="0"/>
                                        <controls:TextValueSlider
                                                x:Name="sldrFuserLineScale" Tag="FuserLineScale"
                                                Minimum="0.5" Maximum="5"
                                                SmallChange="0.1" TickFrequency="0.1"
                                                IsSnapToTickEnabled="True"
                                                ContentStringFormat="{}{0:0.0x}" 
                                                Grid.Column="1"/>
                                    </Grid>

                                    <!-- Widgets -->
                                    <hc:CheckComboBox x:Name="ccbWidgets" Grid.Column="1" Margin="0,0,0,8"
                                                          Style="{StaticResource CheckComboBoxExtend}"
                                                          hc:TitleElement.Title="小工具"
                                                          hc:TitleElement.TitlePlacement="Top"
                                                          hc:InfoElement.Placeholder="任务信息小工具..."/>

                                    <hc:CheckComboBox x:Name="ccbESPOptions" Grid.Column="1" Margin="0,0,0,0"
                                                      Style="{StaticResource CheckComboBoxExtend}"
                                                      hc:TitleElement.Title="选项"
                                                      hc:TitleElement.TitlePlacement="Top"
                                                      hc:InfoElement.Placeholder="瞄准端口、自瞄视野、状态文本..."/>
                                </hc:SimpleStackPanel>
                            </Expander>

                            <!-- Crosshair Settings Section -->
                            <Expander x:Name="expFuserCrosshairSettings" Header="准星设置" Style="{StaticResource PanelExpander}" IsExpanded="True">
                                <hc:SimpleStackPanel Style="{StaticResource ExpanderContent}" Margin="2,8,2,0">
                                    <Grid Margin="5">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <CheckBox x:Name="chkCrosshairEnabled" Content="启用准星" 
                                                      Style="{StaticResource DynamicCheckBoxStyle}" 
                                                      Grid.Column="0" Margin="0,0,15,10" Tag="CrosshairEnabled"/>

                                        <hc:ComboBox x:Name="cboCrosshairType" Grid.Column="1" Tag="CrosshairType" Margin="0,0,0,10"
                                                         IsEnabled="{Binding ElementName=chkCrosshairEnabled, Path=IsChecked}">
                                            <ComboBoxItem Content="十字 (+)" IsSelected="True"/>
                                            <ComboBoxItem Content="交叉 (X)"/>
                                            <ComboBoxItem Content="圆形"/>
                                            <ComboBoxItem Content="点"/>
                                            <ComboBoxItem Content="方形"/>
                                            <ComboBoxItem Content="菱形"/>
                                        </hc:ComboBox>

                                        <!-- Crosshair Scale Slider -->
                                        <TextBlock Text="准星缩放" Style="{StaticResource LabelText}" VerticalAlignment="Center" Grid.Column="0" Grid.Row="1"/>
                                        <controls:TextValueSlider
                                                x:Name="sldrFuserCrosshairScale" Tag="FuserCrosshairScale"
                                                Minimum="0.5" Maximum="5"
                                                SmallChange="0.1" TickFrequency="0.1"
                                                IsSnapToTickEnabled="True"
                                                ContentStringFormat="{}{0:0.0x}" 
                                                Grid.Column="1" Grid.Row="1"/>
                                    </Grid>
                                </hc:SimpleStackPanel>
                            </Expander>

                            <!-- Mini Radar Settings Section -->
                            <Expander x:Name="expFuserMiniRadarSettings" Header="迷你雷达设置" Style="{StaticResource PanelExpander}" IsExpanded="True">
                                <hc:SimpleStackPanel Style="{StaticResource ExpanderContent}" Margin="2,8,2,0">
                                    <Grid Margin="5">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <CheckBox x:Name="chkMiniRadarEnabled" Content="启用迷你雷达" 
                                                      Style="{StaticResource DynamicCheckBoxStyle}" 
                                                     Grid.Row="0" Grid.Column="0" Margin="0,0,0,8" Tag="MiniRadarEnabled"/>

                                        <CheckBox x:Name="chkMiniRadarLoot" Content="显示战利品" 
                                                      Style="{StaticResource DynamicCheckBoxStyle}" 
                                                     Grid.Row="1" Grid.Column="0" Margin="0,0,0,10" Tag="MiniRadarLoot"/>

                                        <!-- Mini Radar Scale Slider -->
                                        <TextBlock Text="缩放" Style="{StaticResource LabelText}" 
                                                   VerticalAlignment="Center" Grid.Row="2" Grid.Column="0"/>
                                        <controls:TextValueSlider
                                                x:Name="sldrFuserMiniRadarScale" Tag="FuserMiniRadarScale"
                                                Minimum="0.5" Maximum="5"
                                                SmallChange="0.1" TickFrequency="0.1"
                                                IsSnapToTickEnabled="True"
                                                ContentStringFormat="{}{0:0.0x}" 
                                                Grid.Row="2" Grid.Column="1"/>
                                    </Grid>
                                </hc:SimpleStackPanel>
                            </Expander>

                            <!-- Player Information Expander -->
                            <Expander x:Name="expFuserPlayerInformation" Header="玩家信息" Style="{StaticResource PanelExpander}" IsExpanded="True">
                                <hc:SimpleStackPanel Style="{StaticResource ExpanderContent}" Margin="2,8,2,0">
                                    <!-- Player Type Selection -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="玩家类型" Style="{StaticResource LabelText}" VerticalAlignment="Center"/>
                                        <hc:ComboBox x:Name="cboFuserPlayerType" Grid.Column="1" Tag="FuserPlayerType"/>
                                    </Grid>

                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        
                                        <CheckBox x:Name="chkHighAlert" Content="高警报指示器" Tag="HighAlertIndicator"
                                              Margin="0,0,0,10" Grid.Row="0" Grid.Column="0"
                                              Style="{StaticResource DynamicCheckBoxStyle}"/>

                                        <CheckBox x:Name="chkImportantIndicators" Content="重要指示器" Tag="ImportantIndicators"
                                              Margin="0,0,0,10" Grid.Row="0" Grid.Column="1"
                                              Style="{StaticResource DynamicCheckBoxStyle}"/>

                                        <CheckBox x:Name="chkShowImportantPlayerLoot" Content="显示重要战利品" Tag="ShowImportantPlayerLoot"
                                              Margin="0,0,0,10" Grid.Row="1" Grid.Column="1"
                                              Style="{StaticResource DynamicCheckBoxStyle}"/>
                                    </Grid>

                                    <!-- Max Render Distance -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="渲染距离" Style="{StaticResource LabelText}" 
                                                   VerticalAlignment="Center" Grid.Column="0"/>
                                        <controls:TextValueSlider
                                                x:Name="sldrPlayerTypeRenderDistance" Tag="PlayerTypeRenderDistance"
                                                Minimum="0" Maximum="1500"
                                                MinContent="关闭" MaxContent="最大"
                                                SmallChange="1" TickFrequency="1"
                                                IsSnapToTickEnabled="True"
                                                ContentStringFormat="{}{0:0m}" 
                                                Grid.Column="1"/>
                                    </Grid>

                                    <!-- Render Mode Selection -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="渲染模式" Style="{StaticResource LabelText}" 
                                                   VerticalAlignment="Center" Grid.Column="0"/>
                                        <hc:ComboBox x:Name="cboPlayerRenderMode" Grid.Column="1" Tag="PlayerRenderMode">
                                            <ComboBoxItem Content="无"/>
                                            <ComboBoxItem Content="骨骼" IsSelected="True"/>
                                            <ComboBoxItem Content="盒子"/>
                                            <ComboBoxItem Content="头部点"/>
                                        </hc:ComboBox>
                                    </Grid>

                                    <hc:SimpleStackPanel x:Name="playerSpecificSettings" Margin="0,0,0,0">
                                        <!-- KD Settings -->
                                        <Grid x:Name="kdSettings" Visibility="Collapsed" Margin="0,0,0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="120"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="最低KD" Style="{StaticResource LabelText}" 
                                                VerticalAlignment="Center" Grid.Column="0"/>
                                            <controls:TextValueSlider
                                                x:Name="sldrMinimumKD" Tag="MinimumKD"
                                                Minimum="0.1" Maximum="15.0"
                                                SmallChange="0.1" TickFrequency="0.1"
                                                IsSnapToTickEnabled="True"
                                                ContentStringFormat="{}{0:0.0}" 
                                                Grid.Column="1"/>
                                        </Grid>
                                    </hc:SimpleStackPanel>

                                    <!-- Information Selection -->
                                    <hc:CheckComboBox x:Name="ccbFuserPlayerInformation" Grid.Column="1" Margin="0,0,0,0"
                                                          Style="{StaticResource CheckComboBoxExtend}"
                                                          hc:TitleElement.Title="信息"
                                                          hc:TitleElement.TitlePlacement="Top"
                                                          hc:InfoElement.Placeholder="名称、生命值、距离、武器..."/>
                                </hc:SimpleStackPanel>
                            </Expander>

                            <!-- Entity Information Expander -->
                            <Expander x:Name="expFuserEntityInformation" Header="实体信息" Style="{StaticResource PanelExpander}" IsExpanded="True">
                                <hc:SimpleStackPanel Style="{StaticResource ExpanderContent}" Margin="2,8,2,0">
                                    <!-- Entity Type Selection -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="实体类型" Style="{StaticResource LabelText}" VerticalAlignment="Center"/>
                                        <hc:ComboBox x:Name="cboFuserEntityType" Grid.Column="1" Tag="FuserEntityType"/>
                                    </Grid>

                                    <hc:SimpleStackPanel x:Name="entitySpecificSettings" Margin="0,0,0,0">
                                        <!-- Corpse Settings -->
                                        <Grid x:Name="corpseSettings" Visibility="Collapsed">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <CheckBox x:Name="chkShowImportantCorpseLoot" Content="显示重要尸体战利品" Tag="ShowImportantCorpseLoot"
                                                      Style="{StaticResource DynamicCheckBoxStyle}" Grid.Column="0" Margin="0,0,5,8"/>
                                        </Grid>
                                        
                                        <!-- Door Settings -->
                                        <Grid x:Name="doorSettings" Visibility="Collapsed">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <CheckBox x:Name="chkShowLockedDoors" Content="显示锁定的门" Tag="ShowLockedDoors"
                                                      Style="{StaticResource DynamicCheckBoxStyle}" Grid.Column="0" Margin="0,0,5,8"/>
                                            <CheckBox x:Name="chkShowUnlockedDoors" Content="显示未锁定的门" Tag="ShowUnlockedDoors"
                                                      Style="{StaticResource DynamicCheckBoxStyle}" Grid.Column="1" Margin="0,0,5,8"/>
                                        </Grid>

                                        <!-- Tripwire Settings -->
                                        <Grid x:Name="tripwireSettings" Visibility="Collapsed">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <CheckBox x:Name="chkShowTripwireLine" Content="显示绊线" Tag="ShowTripwireLine"
                                                      Style="{StaticResource DynamicCheckBoxStyle}" Grid.Column="0" Margin="0,0,5,8"/>
                                        </Grid>

                                        <!-- Grenade Settings -->
                                        <Grid x:Name="grenadeSettings" Visibility="Collapsed">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <CheckBox x:Name="chkShowGrenadeRadius" Content="显示半径" Tag="ShowGrenadeRadius"
                                                      Style="{StaticResource DynamicCheckBoxStyle}" 
                                                      Grid.Row="0" Grid.Column="0" Margin="0,0,5,8"/>
                                            <CheckBox x:Name="chkShowGrenadeTrail" Content="显示轨迹" Tag="ShowGrenadeTrail"
                                                      Style="{StaticResource DynamicCheckBoxStyle}" 
                                                      Grid.Row="0" Grid.Column="1" Margin="5,0,0,8"/>

                                            <TextBlock Text="轨迹持续时间" Style="{StaticResource LabelText}" 
                                                       VerticalAlignment="Center" Grid.Row="1" Grid.Column="0" Margin="0,0,5,8"
                                                       Visibility="{Binding ElementName=chkShowGrenadeTrail, Path=IsChecked, Converter={StaticResource Boolean2VisibilityConverter}}"/>
                                            <controls:TextValueSlider
                                                x:Name="sldrTrailDuration" Tag="TrailDuration"
                                                Minimum="0.1" Maximum="6"
                                                SmallChange="0.1" TickFrequency="0.1"
                                                IsSnapToTickEnabled="True"
                                                ContentStringFormat="{}{0:0.0}s" 
                                                Grid.Row="1" Grid.Column="1" Margin="5,0,0,8"
                                                Visibility="{Binding ElementName=chkShowGrenadeTrail, Path=IsChecked, Converter={StaticResource Boolean2VisibilityConverter}}"/>

                                            <TextBlock Text="最小轨迹距离" Style="{StaticResource LabelText}" 
                                                             VerticalAlignment="Center" Grid.Row="2" Grid.Column="0" Margin="0,0,5,0"
                                                             Visibility="{Binding ElementName=chkShowGrenadeTrail, Path=IsChecked, Converter={StaticResource Boolean2VisibilityConverter}}"/>
                                            <controls:TextValueSlider
                                                x:Name="sldrMinTrailDistance" Tag="MinTrailDistance"
                                                Minimum="0.01" Maximum="4"
                                                SmallChange="0.01" TickFrequency="0.01"
                                                IsSnapToTickEnabled="True"
                                                ContentStringFormat="{}{0:0.00}m" 
                                                Grid.Row="2" Grid.Column="1" Margin="5,0,0,8"
                                                Visibility="{Binding ElementName=chkShowGrenadeTrail, Path=IsChecked, Converter={StaticResource Boolean2VisibilityConverter}}"/>
                                        </Grid>
                                    </hc:SimpleStackPanel>

                                    <!-- Render Mode -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="渲染模式" Style="{StaticResource LabelText}" 
                                                   VerticalAlignment="Center" Grid.Column="0"/>
                                        <hc:ComboBox x:Name="cboEntityRenderMode" Grid.Column="1" Tag="EntityRenderMode">
                                            <ComboBoxItem Content="无"/>
                                            <ComboBoxItem Content="点"/>
                                            <ComboBoxItem Content="交叉"/>
                                            <ComboBoxItem Content="十字"/>
                                            <ComboBoxItem Content="方形" IsSelected="True"/>
                                            <ComboBoxItem Content="菱形"/>
                                        </hc:ComboBox>
                                    </Grid>

                                    <!-- Render Distance -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Text="渲染距离" Style="{StaticResource LabelText}" 
                                                   VerticalAlignment="Center" Grid.Column="0"/>
                                        <controls:TextValueSlider
                                            x:Name="sldrEntityTypeRenderDistance" Tag="EntityTypeRenderDistance"
                                            Minimum="0" Maximum="1500"
                                            MinContent="关闭" MaxContent="最大"
                                            SmallChange="1" TickFrequency="1"
                                            IsSnapToTickEnabled="True"
                                            ContentStringFormat="{}{0:0m}" 
                                            Grid.Column="1"/>
                                    </Grid>

                                    <!-- Information Selection -->
                                    <hc:CheckComboBox x:Name="ccbFuserEntityInformation" Grid.Column="1" Margin="0,0,0,0"
                                                      Style="{StaticResource CheckComboBoxExtend}"
                                                      hc:TitleElement.Title="信息"
                                                      hc:TitleElement.TitlePlacement="Top"
                                                      hc:InfoElement.Placeholder="名称、距离、价值..."/>
                                </hc:SimpleStackPanel>
                            </Expander>
                        </hc:SimpleStackPanel>
                    </ScrollViewer>
                </hc:TabItem>
            </hc:TabControl>

            <!-- Resize handle -->
            <Grid Style="{StaticResource ResizeHandle}"
                  MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown">
                <Path Style="{StaticResource ResizeHandleIcon}"/>
            </Grid>
        </Grid>
    </Grid>
</UserControl>